<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Success - Build Durable Agents</title>
    <link rel="stylesheet" href="static/src/css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #gradient-canvas {
            width: 100%;
            height: 100%;
            --gradient-color-1: #FDA110;
            --gradient-color-2: #444CE7;
            --gradient-color-3: #211B4E;
            --gradient-color-4: #D300DB;
        }

        .full-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }

        .content-section {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 485px;
            height: 100vh;
            padding: 0 24px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .temporal-logo {
            display: block;
            margin: 40px auto 0;
            width: 48px;
            height: 48px;
        }

        .main-heading {
            color: #FFF;
            text-align: center;
            font-family: 'Aeonik', sans-serif;
            font-size: 2.375rem;
            font-style: normal;
            font-weight: 300;
            line-height: 2.25rem;
            margin-top: 1.5rem;
        }

        .subtitle {
            color: #F8FAFC;
            text-align: center;
            font-family: 'Aeonik', sans-serif;
            font-size: 0.875rem;
            font-style: normal;
            font-weight: 400;
            line-height: 1.25rem;
            margin-top: 0.34rem;
        }

        .checkmark-container {
            display: flex;
            justify-content: center;
            margin-top: 2.91rem;
        }

        .checkmark-circle {
            display: flex;
            width: 2.5rem;
            height: 2.5rem;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            border-radius: 1048575rem;
            border: 1px solid #00BC7D;
            background: rgba(0, 0, 0, 0.30);
        }

        .checkmark-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
        }

        .success-heading {
            display: flex;
            width: 100%;
            justify-content: center;
            align-items: center;
            gap: 0.875rem;
            margin-top: 1.5rem;
        }

        .party-popper {
            color: #00BC7D;
            text-align: center;
            font-size: 1.5rem;
            font-style: normal;
            font-weight: 300;
            line-height: 2rem;
        }

        .success-heading-text {
            color: #FFF;
            text-align: center;
            font-family: 'Aeonik', sans-serif;
            font-size: 1.5rem;
            font-style: normal;
            font-weight: 300;
            line-height: 2rem;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .download-container {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            margin-top: 24px;
            gap: 1.25rem;
        }

        .btn-start-over {
            display: flex;
            padding: 1rem;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 0.875rem;
            background: rgba(0, 0, 0, 0.40);
            color: #FFF;
            border-radius: 0;
            text-decoration: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-style: normal;
            font-weight: 500;
            line-height: 1.5rem;
        }

        .btn-start-over img {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;
        }

        .btn {
            display: flex;
            padding: 0.75rem 1.5rem;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            align-self: stretch;
            border-radius: 0.5rem;
            font-family: 'Aeonik', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            display: flex;
            height: 3.625rem;
            flex-direction: row;
            align-items: center;
            align-self: stretch;
            background: #096;
            color: #FFF;
            border-radius: 0;
            padding: 1.19rem 1rem;
            gap: 0.75rem;
        }

        .btn-primary svg.file-icon {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
        }

        .btn-primary svg.file-icon path {
            stroke: #FFF;
            stroke-width: 1.667;
        }

        .btn-primary .btn-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .btn-secondary {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.40);
            color: #FFF;
            border-radius: 0;
            padding: 1rem;
            gap: 0.875rem;
            min-width: 230px;
        }

        .btn svg {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
        }

        .chevron {
            margin-left: auto;
            transition: transform 0.3s ease;
        }

        .chevron.open {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #FFF;
            margin-top: 0;
        }

        .accordion-content.open {
            max-height: 600px;
            overflow-y: auto;
        }

        .markdown-content {
            padding: 20px;
            font-family: 'Aeonik', sans-serif;
            color: #000;
        }

        .markdown-content h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #000;
        }

        .markdown-content h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #000;
        }

        .markdown-content p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            color: #000;
        }

        .placeholder-image {
            width: 100%;
            height: auto;
            margin: 1rem 0 1rem 0;
        }

        .placeholder-image img {
            width: 100%;
        }
    </style>
</head>
<body>
    <canvas id="gradient-canvas"></canvas>
    <div class="full-overlay"></div>

    <div class="content-section">
        <!-- Temporal Logo -->
        <svg class="temporal-logo" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M32.4154 15.5846C31.2802 7.09512 28.4175 0 24 0C19.5949 0 16.7198 7.09512 15.5846 15.5846C7.09511 16.7198 0 19.5825 0 24C0 28.4051 7.09511 31.2802 15.5846 32.4154C16.7198 40.9049 19.5825 48 24 48C28.4051 48 31.2802 40.9049 32.4154 32.4154C40.9049 31.2802 48 28.4175 48 24C48 19.5825 40.9049 16.7075 32.4154 15.5846ZM15.3131 29.9229C7.18149 28.7506 2.43084 26.0607 2.43084 23.9877C2.43084 21.9147 7.16915 19.2247 15.3131 18.0524C15.128 20.0144 15.0416 22.0134 15.0416 23.9877C15.0416 25.962 15.128 27.9733 15.3131 29.9229ZM24 2.41851C26.073 2.41851 28.763 7.15682 29.9352 15.3008C27.9733 15.1157 25.9743 15.0293 24 15.0293C22.0257 15.0293 20.0267 15.128 18.0648 15.3008C19.237 7.16916 21.927 2.41851 24 2.41851ZM32.6869 29.9229C32.292 29.9846 30.6386 30.1697 30.2314 30.219C30.1943 30.6386 29.9969 32.2797 29.9352 32.6746C28.763 40.8062 26.073 45.5568 24 45.5568C21.927 45.5568 19.237 40.8185 18.0648 32.6746C18.0031 32.2797 17.818 30.6262 17.7686 30.219C17.5835 28.2941 17.4602 26.2211 17.4602 23.9877C17.4602 21.7542 17.5712 19.6936 17.7686 17.7563C19.6936 17.5712 21.7666 17.4478 24 17.4478C26.2334 17.4478 28.2941 17.5589 30.2314 17.7563C30.6509 17.7933 32.292 17.9907 32.6869 18.0524C40.8185 19.2247 45.5691 21.9147 45.5691 23.9877C45.5691 26.0607 40.8185 28.7506 32.6869 29.9229Z" fill="#F8FAFC"/>
        </svg>
        
        <!-- Main Heading -->
        <h1 class="main-heading">Build Durable Agents</h1>
        <p class="subtitle">Powered by Temporal</p>

        <!-- Success Heading -->
        <div class="success-heading">
            <span class="party-popper">ðŸŽ‰</span>
            <span class="success-heading-text">Research Complete</span>
        </div>

        <div class="placeholder-image">
            <img class="report-image" alt="AI-Generated Research Visualization" src=""/>
        </div>

        <!-- Buttons -->
        <div class="buttons-container">
            <button class="btn btn-primary" id="viewReportBtn">
                <svg class="file-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.99967 18.3337C4.55765 18.3337 4.13372 18.1581 3.82116 17.8455C3.5086 17.5329 3.33301 17.109 3.33301 16.667V3.33366C3.33301 2.89163 3.5086 2.46771 3.82116 2.15515C4.13372 1.84259 4.55765 1.66699 4.99967 1.66699H11.6663C11.9301 1.66657 12.1914 1.71833 12.4351 1.8193C12.6788 1.92027 12.9001 2.06846 13.0863 2.25533L16.0763 5.24533C16.2637 5.43158 16.4123 5.65312 16.5136 5.89713C16.6149 6.14114 16.6668 6.4028 16.6663 6.66699V16.667C16.6663 17.109 16.4907 17.5329 16.1782 17.8455C15.8656 18.1581 15.4417 18.3337 14.9997 18.3337H4.99967Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.667 1.66699V5.83366C11.667 6.05467 11.7548 6.26663 11.9111 6.42291C12.0674 6.57919 12.2793 6.66699 12.5003 6.66699H16.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.33366 7.5H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.3337 10.833H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.3337 14.167H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="btn-content">
                    <span>View Markdown Report</span>
                    <svg class="chevron open" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 7.5L10 12.5L15 7.5" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </button>
        </div>

        <!-- Accordion Content -->
        <div class="accordion-content open" id="accordionContent">
            <div class="markdown-content">
                <img src="" alt="Report Preview" style="width: 395px; height: 246.08px; background: #E5E7EB; border-radius: 4px; margin-bottom: 1rem;">
                
                <h1>Title</h1>
                
                <h2>Heading</h2>
                
                <p>According to all known laws of aviation, there is no way a bee should be able to fly.Its wings are too small to get its fat little body off the ground.The bee, of course, flies anyway because bees don't care what humans think is impossible.Yellow, black. Yellow, black. Yellow, black. Yellow, black.Ooh, black and yellow!Let's shake it up a little.Barry! Breakfast is ready! Coming!Hang on a second.Hello? Barry? Adam? Can you believe this is happening?I can't.I'll pick you up.Looking sharp.Use the stairs, Your father paid good money for those.Sorry. I'm excited. Here's the graduate.We're very proud of you, son.A perfect report card, all B's.Very proud. Ma! I got a thing going here. You got lint on your fuzz.Ow! That's me!Wave to us! We'll be in row 118,000.Bye!Barry, I told you, stop flying in the house!Hey, Adam.Hey, Barry. Is that fuzz gel?A little. Special day, graduation.Never thought I'd make it.Three days grade school, three days high school.Those were awkward.Three days college. I'm glad I took a day and hitchhiked around The Hive. You did come back different.Hi, Barry. Artie, growing a mustache? Looks good.Hear about Frankie?Yeah. You going to the funeral?No, I'm not going.Everybody knows, sting someone, you die.Don't waste it on a squirrel.Such a hothead.I guess he could have just gotten out of the way.I love this incorporating an amusement park into our day.That's why we don't need vacations.Boy, quite a bit of pomp under the circumstances.Well, Adam, today we are men.We are!Bee-men.Amen!Hallelujah!</p>
            </div>
        </div>

        <!-- Download Button Container -->
        <div class="download-container">
            <a href="#" class="btn btn-secondary" download>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M4.99967 18.3337C4.55765 18.3337 4.13372 18.1581 3.82116 17.8455C3.5086 17.5329 3.33301 17.109 3.33301 16.667V3.33366C3.33301 2.89163 3.5086 2.46771 3.82116 2.15515C4.13372 1.84259 4.55765 1.66699 4.99967 1.66699H11.6663C11.9301 1.66657 12.1914 1.71833 12.4351 1.8193C12.6788 1.92027 12.9001 2.06846 13.0863 2.25533L16.0763 5.24533C16.2637 5.43158 16.4123 5.65312 16.5136 5.89713C16.6149 6.14114 16.6668 6.4028 16.6663 6.66699V16.667C16.6663 17.109 16.4907 17.5329 16.1782 17.8455C15.8656 18.1581 15.4417 18.3337 14.9997 18.3337H4.99967Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.667 1.66699V5.83366C11.667 6.05467 11.7548 6.26663 11.9111 6.42291C12.0674 6.57919 12.2793 6.66699 12.5003 6.66699H16.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.33366 7.5H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.3337 10.833H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.3337 14.167H6.66699" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Download Markdown
            </a>
            <a href="/" class="btn-start-over">
                <img src="static/public/icons/start-over.svg" alt="Start Over">
                Start Over
            </a>
        </div>
    </div>

    <script type="module">
        import { NeatGradient } from 'https://cdn.jsdelivr.net/npm/@firecms/neat@0.3.0/+esm';

        const neat = new NeatGradient({
            ref: document.getElementById('gradient-canvas'),
            colors: [
                {
                    color: '#FDA110',
                    enabled: true,
                },
                {
                    color: '#444CE7',
                    enabled: true,
                },
                {
                    color: '#211B4E',
                    enabled: true,
                },
                {
                    color: '#D300DB',
                    enabled: true,
                },
                {
                    color: '#f5e1e5',
                    enabled: false,
                },
            ],
            speed: 1.5,
            horizontalPressure: 3,
            verticalPressure: 5,
            waveFrequencyX: 2,
            waveFrequencyY: 3,
            waveAmplitude: 5,
            shadows: 0,
            highlights: 2,
            colorBrightness: 1,
            colorSaturation: 7,
            wireframe: false,
            colorBlending: 7,
            backgroundColor: '#003FFF',
            backgroundAlpha: 1,
            grainScale: 2,
            grainSparsity: 0,
            grainIntensity: 0.5,
            grainSpeed: 1,
            resolution: 1,
        });
    </script>

    <script src="static/src/js/api-client.js"></script>
    <script>
        // Accordion functionality
        const viewReportBtn = document.getElementById('viewReportBtn');
        const accordionContent = document.getElementById('accordionContent');
        const chevron = viewReportBtn.querySelector('.chevron');
        const markdownContent = document.querySelector('.markdown-content');
        const reportImage = document.querySelector('.report-image');

        viewReportBtn.addEventListener('click', function() {
            accordionContent.classList.toggle('open');
            chevron.classList.toggle('open');
        });

        // Load research result from sessionStorage
        async function loadResearchResult() {
            let workflowId = sessionStorage.getItem('workflowId');
            let resultJson = sessionStorage.getItem('researchResult');

            if (!resultJson) {
                const params = new URLSearchParams(window.location.search);
                workflowId = params.get("wf");

                if (!workflowId) {
                    console.log('No research result found');
                    return;
                }

                const API_BASE_URL = 'http://localhost:8234';
                const client = new ResearchClient(API_BASE_URL);

                result = await client.getResult(workflowId);
                resultJson = JSON.stringify(result)

                if (!resultJson) {
                    console.log('No research result found');
                    return;
                }
            }

            try {
                const result = JSON.parse(resultJson);
                
                // Display the markdown report
                if (result.markdown_report) {
                    markdownContent.innerHTML = convertMarkdownToHTML(result.markdown_report);
                }

                if (result.image_file_path) {
                    reportImage.src = result.image_file_path;
                }

                // Setup download button
                const downloadBtn = document.querySelector('.btn-secondary');
                if (downloadBtn && result.markdown_report) {
                    downloadBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        downloadMarkdown(result.markdown_report, workflowId);
                    });
                }
            } catch (error) {
                console.error('Error loading result:', error);
            }
        }

        // Simple markdown to HTML converter
        function convertMarkdownToHTML(markdown) {
            let html = markdown;
            
            // Headers
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Paragraphs
            html = html.split('\n\n').map(para => {
                if (!para.startsWith('<h') && para.trim()) {
                    return '<p>' + para + '</p>';
                }
                return para;
            }).join('\n');
            
            return html;
        }

        // Download markdown as file
        function downloadMarkdown(content, workflowId) {
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `research-report-${workflowId || 'result'}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load result on page load
        document.addEventListener('DOMContentLoaded', loadResearchResult);
    </script>
</body>
</html>
